<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>오직미 거래처 식당 리스트</title>
  <style>
    :root {
      color-scheme: light;
      --bg: #f8fafc;
      --card: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --muted: #64748b;
      --link: #2563eb;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Pretendard", "Noto Sans KR", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    header {
      padding: 32px 16px 12px;
      text-align: center;
    }

    header h1 {
      margin: 0 0 8px;
      font-size: clamp(1.5rem, 2vw + 1rem, 2.4rem);
      letter-spacing: -0.02em;
    }

    header p {
      margin: 0;
      color: var(--muted);
      font-size: 0.95rem;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }

    .status {
      margin: 16px auto 24px;
      padding: 12px 16px;
      border-radius: 12px;
      background: #e2e8f0;
      color: #334155;
      font-weight: 600;
      text-align: center;
    }

    .list {
      display: grid;
      gap: 16px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      display: grid;
      gap: 12px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
    }

    .card header {
      padding: 0;
      text-align: left;
    }

    .card h2 {
      margin: 0 0 4px;
      font-size: 1.1rem;
    }

    .meta {
      display: grid;
      gap: 4px;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .meta strong {
      color: var(--text);
      font-weight: 600;
    }

    .image-wrap {
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border);
      background: #f1f5f9;
    }

    .image-wrap img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .link-row {
      display: grid;
      gap: 4px;
      font-size: 0.9rem;
    }

    .link-row a {
      color: var(--link);
      text-decoration: none;
      word-break: break-all;
    }

    .link-row a:hover {
      text-decoration: underline;
    }

    @media (min-width: 720px) {
      .card {
        grid-template-columns: 220px 1fr;
        align-items: start;
      }

      .image-wrap {
        align-self: start;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>오직미 거래처 식당 리스트</h1>
    <p>오직미 거래처(식당)를 한눈에 확인할 수 있는 전용 리스트입니다.</p>
  </header>
  <main>
    <div class="status" id="status">데이터를 불러오는 중...</div>
    <section class="list" id="list" aria-live="polite"></section>
  </main>

  <script>
    const CSV_PATH = "./오직미_식당리스트 - 오직미_식당디렉토리_사이트개발용_최종정비.csv";

    const parseCsv = (text) => {
      const rows = [];
      let row = [];
      let current = "";
      let inQuotes = false;

      for (let i = 0; i < text.length; i += 1) {
        const char = text[i];
        const next = text[i + 1];

        if (char === '"') {
          if (inQuotes && next === '"') {
            current += '"';
            i += 1;
          } else {
            inQuotes = !inQuotes;
          }
          continue;
        }

        if (char === ',' && !inQuotes) {
          row.push(current);
          current = "";
          continue;
        }

        if ((char === '\n' || char === '\r') && !inQuotes) {
          if (char === '\r' && next === '\n') {
            i += 1;
          }
          row.push(current);
          if (row.length > 1 || row[0] !== "") {
            rows.push(row);
          }
          row = [];
          current = "";
          continue;
        }

        current += char;
      }

      if (current.length || row.length) {
        row.push(current);
        rows.push(row);
      }

      return rows;
    };

    const createCard = (restaurant) => {
      const card = document.createElement("article");
      card.className = "card";

      const imageCell = document.createElement("div");
      if (restaurant.image) {
        imageCell.className = "image-wrap";
        const img = document.createElement("img");
        img.src = restaurant.image;
        img.alt = `${restaurant.name} 이미지`;
        img.loading = "lazy";
        imageCell.appendChild(img);
      }

      const content = document.createElement("div");
      const header = document.createElement("header");
      const title = document.createElement("h2");
      title.textContent = restaurant.name;
      const meta = document.createElement("div");
      meta.className = "meta";
      meta.innerHTML = `
        <div><strong>주소:</strong> ${restaurant.address}</div>
        <div><strong>지역:</strong> ${restaurant.region}</div>
        <div><strong>유형:</strong> ${restaurant.category}</div>
      `;
      header.appendChild(title);
      header.appendChild(meta);

      const links = document.createElement("div");
      links.className = "link-row";

      if (restaurant.place) {
        const placeLink = document.createElement("a");
        placeLink.href = restaurant.place;
        placeLink.target = "_blank";
        placeLink.rel = "noopener noreferrer";
        placeLink.textContent = "네이버 플레이스 보기";
        links.appendChild(placeLink);
      }

      if (restaurant.image) {
        const imageLink = document.createElement("a");
        imageLink.href = restaurant.image;
        imageLink.target = "_blank";
        imageLink.rel = "noopener noreferrer";
        imageLink.textContent = restaurant.image;
        links.appendChild(imageLink);
      }

      content.appendChild(header);
      if (links.children.length > 0) {
        content.appendChild(links);
      }

      if (imageCell.childElementCount) {
        card.appendChild(imageCell);
      }
      card.appendChild(content);

      return card;
    };

    const formatRegion = (row) => {
      const parts = [row[5], row[6], row[7]].filter(Boolean);
      return parts.join(" ") || "-";
    };

    const formatCategory = (row) => {
      const parts = [row[8], row[9], row[10]].filter(Boolean);
      return parts.join(" · ") || "-";
    };

    const init = async () => {
      const status = document.getElementById("status");
      const list = document.getElementById("list");

      try {
        const response = await fetch(CSV_PATH);
        if (!response.ok) {
          throw new Error("데이터를 불러오지 못했습니다.");
        }
        const text = await response.text();
        const rows = parseCsv(text);
        const header = rows[0];
        const dataRows = rows.slice(1).filter((row) => row.length && row.some((value) => value.trim() !== ""));

        const restaurants = dataRows.map((row) => ({
          id: row[0] || "",
          name: row[1] || "이름 미상",
          address: row[2] || "주소 정보 없음",
          place: row[3] || "",
          image: row[4] || "",
          region: formatRegion(row),
          category: formatCategory(row),
          tags: row[11] || "",
        }));

        list.innerHTML = "";
        restaurants.forEach((restaurant) => {
          list.appendChild(createCard(restaurant));
        });

        status.textContent = `총 ${restaurants.length}개 식당이 등록되어 있습니다.`;
      } catch (error) {
        status.textContent = "데이터를 불러오는 중 문제가 발생했습니다.";
        status.style.background = "#fee2e2";
        status.style.color = "#b91c1c";
        console.error(error);
      }
    };

    init();
  </script>
</body>
</html>
